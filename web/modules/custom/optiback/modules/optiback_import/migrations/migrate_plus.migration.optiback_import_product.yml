id: optiback_import_product
status: true
migration_tags:
  - optiback_import
source:
  plugin: optiback_import_csv
  # Path prefix {prefix}{YYYYMMDD}.csv.
  path: 'artikel_'
  # offset first row 0 - is header.
  header_offset: 0
  # Column delimiter. Comma (,) by default.
  # delimiter: '\t' - not working addend in plugin.
  # Field enclosure. Double quotation marks (") by default.
  #enclosure: ''
  ids:
    - ArtNr
  # Here we identify the columns of interest in the source file.
  # Each numeric key is the 0-based index of the column.
  # For each column, the key below is the field name assigned to
  # the data on import, to be used in field mappings below.
  # The label value is a user-friendly string for display by the
  # migration UI.
  fields:
    0:
      name: ArtNr
      label: 'ArtNr'
    1:
      name: ArtKurbez
      label: 'ArtKurbez'
    2:
      name: ArtBez1
      label: 'ArtBez1'
    3:
      name: ArtBez2
      label: 'ArtBez2'
    4:
      name: EAN
      label: 'EAN'
    5:
      name: AgNr
      label: 'AgNr'
    6:
      name: AgBez
      label: 'AgBez'
    7:
      name: WgNr
      label: 'WgNr'
    8:
      name: WgBez
      label: 'WgBez'
    9:
      name: BestGrpNr
      label: 'BestGrpNr'
    10:
      name: BestGrpBez
      label: 'BestGrpBez'
    11:
      name: ListRang
      label: 'ListRang'
    12:
      name: VertrEH
      label: 'VertrEH'
    13:
      name: VerpackEH
      label: 'VerpackEH'
    14:
      name: VertrEhZwang
      label: 'VertrEhZwang'
    15:
      name: MsEhBez
      label: 'MsEhBez'
    16:
      name: PreisEhBez
      label: 'PreisEhBez'
    17:
      name: LvkB
      label: 'LvkB'
    18:
      name: LvkN
      label: 'LvkN'
    19:
      name: MwstSatz
      label: 'MwstSatz'
    20:
      name: StueckGew
      label: 'StueckGew'
    21:
      name: AlgSoja
      label: 'AlgSoja'
    22:
      name: AlgEier
      label: 'AlgEier'
    23:
      name: AlgFisch
      label: 'AlgFisch'
    24:
      name: AlgMilch
      label: 'AlgMilch'
    25:
      name: AlgLupinen
      label: 'AlgLupinen'
    26:
      name: AlgSellerie
      label: 'AlgSellerie'
    27:
      name: AlgGluten
      label: 'AlgGluten'
    28:
      name: AlgSenf
      label: 'AlgSenf'
    29:
      name: AlgErdnuss
      label: 'AlgErdnuss'
    30:
      name: AlgWeichtiere
      label: 'AlgWeichtiere'
    31:
      name: AlgSchalenfr
      label: 'AlgSchalenfr'
    32:
      name: AlgSulfite
      label: 'AlgSulfite'
    33:
      name: AlgKrebstiere
      label: 'AlgKrebstiere'
    34:
      name: AlgSesam
      label: 'AlgSesam'
    35:
      name: NwKcal
      label: 'NwKcal'
    36:
      name: NwKj
      label: 'NwKj'
    37:
      name: NwFett
      label: 'NwFett'
    38:
      name: NwFettSaeuren
      label: 'NwFettSaeuren'
    39:
      name: NwKohlenhyd
      label: 'NwKohlenhyd'
    40:
      name: NwZucker
      label: 'NwZucker'
    41:
      name: NwEiweiss
      label: 'NwEiweiss'
    42:
      name: NwBallastst
      label: 'NwBallastst'
    43:
      name: NwSalz
      label: 'NwSalz'
    44:
      name: NwWasser
      label: 'NwWasser'

process:
  title: ArtBez1
  # Anlegen der Zuordnung der ProduktVariation in
  # commerce_product__variations.product_id
  # Damit wird der Datensatz erzeugt.
  variations:
    plugin: migration_lookup
    migration: optiback_import_product_variation
    source: ArtNr
  uid:
    -
      plugin: default_value
      default_value: 1
  status:
    -
      plugin: default_value
      default_value: 1
  stores/target_id:
    plugin: default_value
    default_value: 1
  type:
    plugin: default_value
    default_value: default

  # Fehler: darf nur Ganzzahl enthalten. Nicht mehr verwendet.
  # Bsp: 4,0000001002E+026
  #field_sort:
  #  -
  #    plugin: process_field_sort
  #    source: ListRang

  # Sets taxonomy reference to the warengruppen number (Optiback). nicht mehr verwendet.
  #field_shop_category:
  #  -
  #    plugin: process_shop_cat
  #    source: BestGrpNr

  field_nutritive_value/0:
    plugin: default_value
    default_value: 'Nährwert Kcal'
  field_nutritive_value/1:
    plugin: add_string
    string: ' kcal'
    source: NwKcal

  field_nutritive_value/2:
    plugin: default_value
    default_value: 'Nährwert Energy KJ'
  field_nutritive_value/3:
    plugin: add_string
    string: ' kj'
    source: NwKj

  field_nutritive_value/4:
    plugin: default_value
    default_value: 'Nährwert Fett'
  field_nutritive_value/5:
    plugin: add_string
    string: ' g'
    source: NwFett

  field_nutritive_value/6:
    plugin: default_value
    default_value: 'Nährwert Fettsäuren'
  field_nutritive_value/7:
    plugin: add_string
    string: ' g'
    source: NwFettSaeuren

  field_nutritive_value/8:
    plugin: default_value
    default_value: 'Nährwert Kohlenhydrate'
  field_nutritive_value/9:
    plugin: add_string
    string: ' g'
    source: NwKohlenhyd

  field_nutritive_value/10:
    plugin: default_value
    default_value: 'Nährwert Zucker'
  field_nutritive_value/11:
    plugin: add_string
    string: ' g'
    source: NwZucker

  field_nutritive_value/12:
    plugin: default_value
    default_value: 'Nährwert Eiweiß'
  field_nutritive_value/13:
    plugin: add_string
    string: ' g'
    source: NwEiweiss

  field_nutritive_value/14:
    plugin: default_value
    default_value: 'Nährwert Ballaststoffe'
  field_nutritive_value/15:
    plugin: add_string
    string: ' g'
    source: NwBallastst

  field_nutritive_value/16:
    plugin: default_value
    default_value: 'Nährwert Salz'
  field_nutritive_value/17:
    plugin: add_string
    string: ' g'
    source: NwSalz

  field_nutritive_value/18:
    plugin: default_value
    default_value: 'Nährwert Wasser'
  field_nutritive_value/19:
    plugin: add_string
    string: ' g'
    source: NwWasser

destination:
  plugin: 'entity:commerce_product'
  default_bundle: default
migration_dependencies:
  required:
    - optiback_import_product_variation
